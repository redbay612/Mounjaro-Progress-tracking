<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒ›å¥æ¨‚ç´€éŒ„èˆ‡åŠ‘é‡æ›ç®—</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background-color: #f8fafc; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .converter-bg { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-indigo-700">çŒ›å¥æ¨‚ (Mounjaro) å¥åº·å°åŠ©æ‰‹</h1>
            <p class="text-gray-500 mt-2">ç´€éŒ„é«”é‡ã€é«”è„‚ä¸¦ç²¾æº–æ›ç®—æ–½æ‰“æ ¼æ•¸</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- å·¦å´ï¼šè¼¸å…¥è¡¨å–®èˆ‡æ›ç®—å™¨ -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- åŠ‘é‡æ›ç®—å™¨ (æ ¹æ“šåœ–ç‰‡é‚è¼¯) -->
                <div class="card p-6 border-t-4 border-indigo-500 overflow-hidden relative">
                    <div class="relative z-10">
                        <h2 class="text-xl font-bold mb-4 text-gray-800 flex items-center">
                            <span class="mr-2">ğŸ’‰</span> åŠ‘é‡æ ¼æ•¸æ›ç®—å™¨
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-1">æ‚¨æ‰‹é‚Šè—¥åŠ‘çš„æ¿ƒåº¦</label>
                                <select id="penType" class="w-full p-2.5 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-400 outline-none">
                                    <option value="5">5 mg è—¥æ°´</option>
                                    <option value="10">10 mg è—¥æ°´</option>
                                    <option value="15" selected>15 mg è—¥æ°´</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-1">æ‚¨æƒ³æ–½æ‰“çš„åŠ‘é‡ (mg)</label>
                                <select id="targetDose" class="w-full p-2.5 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-400 outline-none">
                                    <option value="2.5">2.5 mg</option>
                                    <option value="5">5.0 mg</option>
                                    <option value="7.5">7.5 mg</option>
                                    <option value="10">10.0 mg</option>
                                    <option value="12.5">12.5 mg</option>
                                    <option value="15">15.0 mg</option>
                                </select>
                            </div>
                            <div class="mt-6 p-4 rounded-xl bg-indigo-50 border border-indigo-100 text-center">
                                <p class="text-gray-600 text-sm">å°æ‡‰æ’¥å‹•/æŠ½å–æ ¼æ•¸</p>
                                <p id="resultGrids" class="text-4xl font-black text-indigo-600 mt-1">10 <span class="text-lg font-normal">æ ¼</span></p>
                            </div>
                            <p class="text-[10px] text-gray-400 mt-2">* è«‹å‹™å¿…ä¾ç…§é†«è­·äººå“¡æŒ‡ç¤ºæ“ä½œï¼Œæ­¤å·¥å…·åƒ…ä¾›è¼”åŠ©å°ç…§ã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- æ•¸æ“šç´€éŒ„è¡¨å–® -->
                <div class="card p-6">
                    <h2 class="text-xl font-bold mb-4 text-gray-800">æ–°å¢å¥åº·ç´€éŒ„</h2>
                    <form id="recordForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600">æ—¥æœŸ</label>
                            <input type="date" id="date" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-400 outline-none">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-600">é«”é‡ (kg)</label>
                                <input type="number" id="weight" step="0.1" placeholder="75.0" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-400 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-600">é«”è„‚ (%)</label>
                                <input type="number" id="fat" step="0.1" placeholder="25.0" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-400 outline-none">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600">ç´€éŒ„æœ¬æ¬¡æ–½æ‰“åŠ‘é‡ (mg)</label>
                            <input type="number" id="loggedDose" step="0.5" placeholder="ä¾‹å¦‚: 2.5" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-400 outline-none">
                        </div>
                        <button type="submit" class="w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-700 transition shadow-lg shadow-indigo-200">å„²å­˜æ•¸æ“š</button>
                    </form>
                </div>
            </div>

            <!-- å³å´ï¼šæ•¸æ“šåˆ†æèˆ‡æ­·å² -->
            <div class="lg:col-span-8 space-y-6">
                <!-- æ•¸æ“šæ¦‚è¦½ -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="card p-4 text-center">
                        <p class="text-xs text-gray-500 uppercase font-bold">åˆå§‹é«”é‡</p>
                        <p id="startWeight" class="text-xl font-bold text-gray-700">-- kg</p>
                    </div>
                    <div class="card p-4 text-center">
                        <p class="text-xs text-gray-500 uppercase font-bold">ç›®å‰é«”é‡</p>
                        <p id="currentWeight" class="text-xl font-bold text-gray-700">-- kg</p>
                    </div>
                    <div class="card p-4 text-center bg-green-50">
                        <p class="text-xs text-green-600 uppercase font-bold">ç´¯è¨ˆæ¸›é‡</p>
                        <p id="totalLoss" class="text-2xl font-black text-green-600">0 kg</p>
                    </div>
                    <div class="card p-4 text-center bg-blue-50">
                        <p class="text-xs text-blue-600 uppercase font-bold">æœ€æ–°é«”è„‚</p>
                        <p id="latestFat" class="text-2xl font-black text-blue-600">-- %</p>
                    </div>
                </div>

                <!-- åœ–è¡¨ -->
                <div class="card p-6">
                    <h3 class="text-lg font-bold mb-4 text-gray-700">è¶¨å‹¢åœ–è¡¨åˆ†æ</h3>
                    <div class="h-[300px]">
                        <canvas id="weightChart"></canvas>
                    </div>
                </div>

                <!-- æ­·å²ç´€éŒ„ -->
                <div class="card p-6">
                    <h3 class="text-lg font-bold mb-4 text-gray-700">æ­·å²æ•¸æ“šç´€éŒ„</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-sm font-semibold text-gray-600">æ—¥æœŸ</th>
                                    <th class="px-4 py-2 text-sm font-semibold text-gray-600">æ–½æ‰“åŠ‘é‡</th>
                                    <th class="px-4 py-2 text-sm font-semibold text-gray-600">é«”é‡</th>
                                    <th class="px-4 py-2 text-sm font-semibold text-gray-600">é«”è„‚</th>
                                    <th class="px-4 py-2 text-sm font-semibold text-gray-600">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody" class="divide-y divide-gray-100">
                                <!-- JS å‹•æ…‹æ’å…¥ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- åŠ‘é‡æ›ç®—é‚è¼¯ ---
        const doseMap = {
            "5": { "2.5": 30, "5": 60 },
            "10": { "2.5": 15, "5": 30, "7.5": 45, "10": 60 },
            "15": { "2.5": 10, "5": 20, "7.5": 30, "10": 40, "12.5": 50, "15": 60 }
        };

        const penTypeSelect = document.getElementById('penType');
        const targetDoseSelect = document.getElementById('targetDose');
        const resultGridsDisplay = document.getElementById('resultGrids');

        function updateConversion() {
            const pen = penTypeSelect.value;
            const target = targetDoseSelect.value;
            const gridResult = doseMap[pen][target];

            if (gridResult) {
                resultGridsDisplay.innerHTML = `${gridResult} <span class="text-lg font-normal">æ ¼</span>`;
                resultGridsDisplay.classList.remove('text-gray-400');
                resultGridsDisplay.classList.add('text-indigo-600');
            } else {
                resultGridsDisplay.innerHTML = `<span class="text-xl font-bold">ä¸é©ç”¨</span>`;
                resultGridsDisplay.classList.add('text-gray-400');
            }
        }

        penTypeSelect.addEventListener('change', updateConversion);
        targetDoseSelect.addEventListener('change', updateConversion);

        // --- ç´€éŒ„è¿½è¹¤é‚è¼¯ ---
        let records = JSON.parse(localStorage.getItem('mounjaroRecordsV2')) || [];
        let chart = null;

        const form = document.getElementById('recordForm');
        document.getElementById('date').valueAsDate = new Date();

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const record = {
                id: Date.now(),
                date: document.getElementById('date').value,
                weight: parseFloat(document.getElementById('weight').value),
                fat: parseFloat(document.getElementById('fat').value),
                dose: document.getElementById('loggedDose').value || "--"
            };

            records.push(record);
            records.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem('mounjaroRecordsV2', JSON.stringify(records));
            renderUI();
            form.reset();
            document.getElementById('date').valueAsDate = new Date();
        });

        function deleteRecord(id) {
            if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) {
                records = records.filter(r => r.id !== id);
                localStorage.setItem('mounjaroRecordsV2', JSON.stringify(records));
                renderUI();
            }
        }

        function renderUI() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';
            
            records.slice().reverse().forEach(r => {
                tbody.innerHTML += `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-4 py-3 text-sm">${r.date}</td>
                        <td class="px-4 py-3 text-sm font-bold text-indigo-600">${r.dose} mg</td>
                        <td class="px-4 py-3 text-sm font-medium text-gray-700">${r.weight} kg</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${r.fat} %</td>
                        <td class="px-4 py-3 text-sm text-red-500 cursor-pointer hover:underline" onclick="deleteRecord(${r.id})">åˆªé™¤</td>
                    </tr>
                `;
            });

            if (records.length > 0) {
                const first = records[0].weight;
                const latest = records[records.length - 1].weight;
                document.getElementById('startWeight').innerText = `${first} kg`;
                document.getElementById('currentWeight').innerText = `${latest} kg`;
                document.getElementById('totalLoss').innerText = `${(first - latest).toFixed(1)} kg`;
                document.getElementById('latestFat').innerText = `${records[records.length - 1].fat} %`;
            }

            updateChart();
        }

        function updateChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            if (chart) chart.destroy();

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: records.map(r => r.date),
                    datasets: [
                        {
                            label: 'é«”é‡ (kg)',
                            data: records.map(r => r.weight),
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            fill: true,
                            tension: 0.3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'é«”è„‚ (%)',
                            data: records.map(r => r.fat),
                            borderColor: '#10b981',
                            borderDash: [5, 5],
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { type: 'linear', position: 'left', title: { display: true, text: 'é«”é‡' } },
                        y1: { type: 'linear', position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'é«”è„‚' } }
                    }
                }
            });
        }

        // åˆå§‹åŒ–
        updateConversion();
        renderUI();
    </script>
</body>
</html>